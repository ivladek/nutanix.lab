{
    "name": "ns1",
    "timezone": "Asia/Almaty",
    "boot": {
        "uefi_boot": true
    },
    "memory_mb": 1024,
    "num_vcpus": 1,
    "num_cores_per_vcpu": 1,
    "vm_disks": [
        {
            "is_cdrom": true,
            "is_empty": true,
            "disk_address": {
                "device_bus": "IDE",
                "device_index": 0
            }
        },
        {
            "is_cdrom": false,
            "disk_address": {
                "device_bus": "SCSI",
                "device_index": 0
            },
            "vm_disk_clone": {
                "disk_address": {
                    "vmdisk_uuid": "dd4b145c-9d94-4541-b26d-1ab5a4bee464"
                },
                "minimum_size": 5368709120
            }
        }
    ],
    "vm_nics": [
        {
            "network_uuid": "5c3f2e79-1e75-4a46-bf32-ab427cb27ef6",
            "is_connected": true,
            "request_ip": true,
            "requested_ip_address": "10.1.8.11"
        }
    ],
    "vm_customization_config": {
        "userdata": "#cloud-config\n\nfqdn: ns1.nutanix.lab\nmanage_etc_hosts: true\ntimezone: Asia\/Almaty\n\nusers:\n  - name: nutanix\n    hashed_passwd: $6$rounds=4096$PcS8PVotAkBo0Kwj$o6bingcJqa.wdp5YQc.8k0ngeTmQX\/VKJrCBCfqI7ULG18Y29JcZUM8vPrga\/omeUsyuQ.eEU3wBOAhyMIE351\n    groups: sudo\n    shell: \/bin\/bash\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    lock_passwd: false\n\nssh_pwauth: true\nchpasswd:\n  expire: false\n\nwrite_files:\n  - path: \/etc\/bind\/named.conf.options\n    owner: root:bind\n    permissions: \"0644\"\n    encoding: text\/plain\n    content: |\n      options {\n        directory           \"\/var\/cache\/bind\";\n        listen-on           { any; };\n        listen-on-v6        { none; };\n        dnssec-validation   auto;\n\n        allow-query-cache   { any; };\n        recursion           yes;\n        allow-query         { any; };\n        allow-recursion     { any; };\n        allow-update        { none; };\n        allow-transfer      { any; };\n        notify              explicit;\n\n        masterfile-format   text;\n      };\n\n      logging {\n        channel bind.log {\n          file            \"\/var\/cache\/bind\/bind.log\" versions 10 size 20m;\n          severity        notice;\n          print-category  yes;\n          print-severity  yes;\n          print-time      yes;\n        };\n        category queries  { bind.log; };\n        category default  { bind.log; };\n        category config   { bind.log; };\n      };\n    defer: true\n\n  - path: \/etc\/bind\/named.conf.local\n    owner: root:bind\n    permissions: \"0644\"\n    encoding: text\/plain\n    content: |\n      zone \"nutanix.lab\" IN {\n        type  master;\n        file  \"nutanix.lab.conf\";\n      };\n\n      zone \"8.1.10.in-addr.arpa\" IN {\n        type  master;\n        file  \"10.1.8.0.conf\";\n      };\n    defer: true\n\n  - path: \/var\/cache\/bind\/SOA.conf\n    owner: bind:bind\n    permissions: \"0644\"\n    encoding: text\/plain\n    content: |\n      $TTL 86400    ; 24h\n\n      @ IN SOA      ns1.nutanix.lab. admin.nutanix.lab. (\n        2023072420  ; serial\n        3600        ;  1h refresh\n        600         ; 10m retry\n        432000      ;  5d expire\n        86400       ; 24h default TTL\n      )\n\n      @ NS  ns1.nutanix.lab.\n      @ NS  ns2.nutanix.lab.\n    defer: true\n\n  - path: \/var\/cache\/bind\/nutanix.lab.conf\n    owner: bind:bind\n    permissions: \"0644\"\n    encoding: text\/plain\n    content: |\n      $INCLUDE SOA.conf\n\n      dc1             A   10.1.8.10\n\n      ns1             A   10.1.8.11\n      ns2             A   10.1.8.12\n\n      time            A   10.1.8.201\n      sw-10g-qfx      A   10.1.8.201\n      sw-1g-ex        A   10.1.8.202\n\n      foundation      A   10.1.8.110\n      admin           A   10.1.8.111\n\n      ntnx-ipmi1      A   10.1.8.41\n      ntnx-ipmi2      A   10.1.8.42\n      ntnx-ipmi3      A   10.1.8.43\n      ntnx-ipmi4      A   10.1.8.44\n\n      ntnx-ahv1       A   10.1.8.51\n      ntnx-ahv2       A   10.1.8.52\n      ntnx-ahv3       A   10.1.8.53\n      ntnx-ahv4       A   10.1.8.54\n\n      ntnx-cvm1       A   10.1.8.61\n      ntnx-cvm2       A   10.1.8.62\n      ntnx-cvm3       A   10.1.8.63\n      ntnx-cvm4       A   10.1.8.64\n\n      ntnx-cluster1   A   10.1.8.60\n                      A   10.1.8.61\n                      A   10.1.8.62\n                      A   10.1.8.63\n                      A   10.1.8.64\n\n      ntnx-oc1        A   10.1.8.71\n      ntnx-pc2        A   10.1.8.72\n      ntnx-pc3        A   10.1.8.73\n\n      ntnx-pc         A   10.1.8.70\n                      A   10.1.8.71\n                      A   10.1.8.72\n                      A   10.1.8.73\n\n      NTNX-fs1-1      A   10.1.8.81\n      NTNX-fs1-3      A   10.1.8.82\n      NTNX-fs1-3      A   10.1.8.83\n\n      fs1             A   10.1.8.81\n                      A   10.1.8.82\n                      A   10.1.8.83\n\n      s3              A   10.1.8.91\n                      A   10.1.8.92\n                      A   10.1.8.93\n                      A   10.1.8.94\n\n      *.s3            A   10.1.8.91\n                      A   10.1.8.92\n                      A   10.1.8.93\n                      A   10.1.8.94\n\n      k8s-1           A   10.1.8.100\n    defer: true\n\n  - path: \/var\/cache\/bind\/10.1.8.0.conf\n    owner: bind:bind\n    permissions: \"0644\"\n    encoding: text\/plain\n    content: |\n      $INCLUDE SOA.conf\n\n      10  PTR ns1.nutanix.lab.\n      11  PTR ns1.nutanix.lab.\n      12  PTR ns2.nutanix.lab.\n\n      41  PTR ntnx-ipmi1.nutanix.lab.\n      42  PTR ntnx-ipmi2.nutanix.lab.\n      43  PTR ntnx-ipmi3.nutanix.lab.\n      44  PTR ntnx-ipmi4.nutanix.lab.\n\n      51  PTR ntnx-ahv1.nutanix.lab.\n      52  PTR ntnx-ahv2.nutanix.lab.\n      53  PTR ntnx-ahv3.nutanix.lab.\n      54  PTR ntnx-ahv4.nutanix.lab.\n\n      81  PTR NTNX-fs1-1.nutanix.lab.\n      82  PTR NTNX-fs1-2.nutanix.lab.\n      83  PTR NTNX-fs1-3.nutanix.lab.\n\n      100 PTR k8s-1.nutanix.lab.\n      111 PTR admin.nutanix.lab.\n\n      201 PTR sw-10g-qfx.nutanix.lab.\n      202 PTR sw-10g-ex.nutanix.lab.\n    defer: true\n\npackage_update: true\npackage_upgrade: true\npackages:\n  - ufw\n  - bind9\nruncmd:\n  - hostnamectl set-hostname ns1.nutanix.lab\n  - ufw allow 22\/tcp\n  - ufw allow 53\n  - ufw --force enable\n  - systemctl enable bind9\n  - systemctl start bind9\npower_state:\n    delay: 1\n    timeout: 60\n    mode: reboot\n    message: \"Rebooting machine\"\n    condition: true\n"
    }
}
